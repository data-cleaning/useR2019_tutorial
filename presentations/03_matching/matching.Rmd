---
title: "Approximate Matching"
author: "Mark van der Loo and Edwin de Jonge"
date: "useR!2019"
output: 
  beamer_presentation:
    include:
      in_header: ../00tex/presheader.tex
classoption: "aspectratio=169"
---

## String distance

### Measure how different two strings are

- (Damerau-) Levenshtein, optimal string alignment: nr of typos
- $q$-gram based (e.g. cosine distance): co-occurrence of character $q$-plets.
- Jaro-Winkler typo's/heuristic
- Soundex: do they sound the same when pronounced?

### The stringdist package

```{r}
library(stringdist)
stringdist("mark", "edwin")
```

## Mini-assignment

Compute a few string distances between you and your neighbour.

```{r,eval=FALSE}
# for example
stringdist("mark", "edwin", method="osa")
```

Method is `"osa"`, `"dl"`, `"lv"`, `"qgram"`, `"jw"`, see also `?stringdist`.


## Exact Matching with `match`

```{r}
lookup <- c("Alice","Bob","Carol","Danny")
raw    <- c("Bob","Carl","Rob","bob","Dan","Alice")
i <- match(raw, lookup)
data.frame(raw=raw, matched=lookup[i])
```

## Approximate Matching with `stringdist::amatch`

```{r}
library(stringdist)
j <- amatch(raw, lookup, maxDist=2)
data.frame(raw=raw, matched=lookup[i], amatched=lookup[j])
```

## More on `amatch`

```{r, eval=FALSE}
amatch(x, table, method, maxDist,...)
```

\begin{tabular}{ll}
\texttt{x}      & character data to be matched\\
\texttt{table}  & the lookup table with clean values\\
\texttt{method} & string distance type\\
\texttt{maxDist}& Maximum distance allowed\\
\texttt{...}    & Extra options depending on \texttt{"method"}
\end{tabular}

### Example

```{r,eval=FALSE}
amatch(raw, lookup, method="cosine", maxDist=0.5, q=3)
```


## Most important distance methods

\begin{center}
\begin{tabular}{lll}
\textbf{Method}     & \textbf{Good for} &\texttt{maxDist}\\
\hline
\texttt{"osa"}      & Typing errors & nr of typing errors allowed\\
\texttt{"cosine"}   & Inconsistent word order    & Between $0$ and $1$\\
\texttt{"jw"}       & Name-address data with typing errors & Between $0$ and $1$\\
\hline
\end{tabular}
\end{center}

$$
\;
$$

### Notes

- Jaro-Winkler (\texttt{"jw"}) faster then Optimal String Alignment (\texttt{"osa"})
- For cosine distance (\texttt{"cosine"}) also use `q=3`.
- Cosine distance also suited for (very) long strings.


## Assignment

Enrich data from the `companies` dataset with data from `backbone.csv`.

- Using approximate matching on the `"name"` and `"company"` column.
- Think about and try different distance functions and `maxDist`
- Keep your best solution
- Remove rows that cannot be matched
- Write to `02input/input.csv`





